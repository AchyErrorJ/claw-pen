# OpenClaw Agent Container
# Full OpenClaw instance with built-in chat

FROM node:22-slim

# Install dependencies
RUN apt-get update && apt-get install -y \
    curl \
    ca-certificates \
    && rm -rf /var/lib/apt/lists/*

# Install OpenClaw
RUN npm install -g openclaw

# Create agent workspace
WORKDIR /agent

# Workspace structure
RUN mkdir -p /agent/memory /root/.openclaw/agents/dev/agent

# Copy workspace files
COPY workspace/ /agent/
COPY entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

# Environment
ENV OPENCLAW_WORKSPACE=/agent
ENV NODE_ENV=production
ENV NODE_OPTIONS=--max-old-space-size=1536

# Healthcheck
HEALTHCHECK --interval=30s --timeout=10s --start-period=10s --retries=3 \
    CMD curl -f http://localhost:18790/health || exit 1

# Expose OpenClaw gateway port
EXPOSE 18790

# Start via entrypoint (configures from env vars)
ENTRYPOINT ["/entrypoint.sh"]
